steps:  
  - checkout: self

  - task: AzureKeyVault@1
    displayName: PullSecrets
    inputs:
      azureSubscription: $(azureSubscription)-$(projectName)
      KeyVaultName: $(KeyVaultName)
      SecretsFilter: 'VERCEL-LMG-TOKEN'
      RunAsPreJob: true

  - script: |
        echo '##vso[task.setvariable variable=VERCEL_ORG_ID]$(VERCEL-ORG-ID)'
        echo '##vso[task.setvariable variable=VERCEL_TEAM_ID]$(VERCEL-TEAM-ID)'  
        echo '##vso[task.setvariable variable=VERCEL_PROJECT_ID]$(VERCEL-PROJECT-ID)'
    displayName: 'Set environment variables'

  - task: Bash@3
    inputs:
      targetType: 'inline'
      script: |
        # Write your commands here
        cd $(system.defaultworkingdirectory)
        vercel $(env-parameter) --token=5Zv9i05TAIhylXw8NYWJEQsY --yes
    env:
        VERCEL_ORG_ID: $(VERCEL_ORG_ID)
        VERCEL_TEAM_ID: $(VERCEL_TEAM_ID)
        VERCEL_PROJECT_ID: $(VERCEL_PROJECT_ID)
    displayName: 'Vercel build and deployment' 

